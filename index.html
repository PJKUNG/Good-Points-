<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Good Points</title>
<style>
:root{--green:#2e8b57;--bg:#e9f7ef;--text:#213;}
body{font-family:Inter, system-ui, -apple-system, "Helvetica Neue", Arial, sans-serif;background:var(--bg);color:var(--text);margin:0;padding:16px}
.container{max-width:980px;margin:0 auto}
.card{background:#fff;padding:14px;border-radius:10px;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,0.06)}
h1{color:var(--green);text-align:center;margin:6px 0 14px}
input,textarea,select,button{font-size:15px}
input,textarea,select{width:100%;padding:8px;border-radius:8px;border:1px solid #d7e1da;margin-top:6px}
button{background:var(--green);color:white;border:0;padding:10px 12px;border-radius:8px;cursor:pointer}
button.secondary{background:#6c7e6c}
.small{font-size:13px;color:#666}
.row{display:flex;gap:8px;align-items:center}
.productGrid{display:flex;flex-wrap:wrap;gap:12px}
.productCard{width:170px;background:#fff;border-radius:10px;padding:8px;box-shadow:0 1px 4px rgba(0,0,0,0.06);text-align:center}
.productCard img{width:100%;height:110px;object-fit:cover;border-radius:8px}
.muted{color:#666}
</style>
</head>
<body>
<div class="container">
  <h1>üåø Good Points</h1>

  <div id="loginCard" class="card">
    <h3>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
    <input id="nameInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå admin ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•" />
    <input id="adminPass" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô)" type="password" style="display:none" />
    <div style="margin-top:8px" class="row">
      <button id="loginBtn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
      <button id="demoProducts" class="secondary">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
    </div>
    <p class="small muted">‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô: ‡∏ä‡∏∑‡πà‡∏≠ <b>admin</b> ‡∏£‡∏´‡∏±‡∏™ <b>admin123</b></p>
  </div>

  <div id="userApp" style="display:none">
    <div class="card row" style="justify-content:space-between;align-items:center">
      <div>
        <p>üëã ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ <b id="userName">-</b></p>
        <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <b id="userPoints">0</b></p>
      </div>
      <div>
        <button id="logoutUser" class="secondary">‡∏≠‡∏≠‡∏Å</button>
      </div>
    </div>

    <div class="card">
      <button id="doGoodBtn">‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏µ +1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (cooldown 20 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</button>
      <p id="cooldownMsg" class="small muted"></p>
    </div>

    <div class="card">
      <h3>üéÅ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
      <div id="products" class="productGrid"></div>
    </div>

    <div class="card">
      <h3>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å</h3>
      <ul id="redeemHistory"></ul>
    </div>
  </div>

  <div id="adminApp" style="display:none">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3>üõ† ‡πÅ‡∏ú‡∏á‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• (Admin)</h3>
        <div>
          <button id="logoutAdmin" class="secondary">‡∏≠‡∏≠‡∏Å</button>
        </div>
      </div>
      <p class="small muted">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ, ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</p>
    </div>

    <div class="card">
      <h4>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h4>
      <input id="prodName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" />
      <input id="prodCost" placeholder="‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç)" type="number" />
      <input id="prodImageUrl" placeholder="‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î" />
      <input id="prodImageFile" type="file" accept="image/*" />
      <div style="margin-top:8px" class="row">
        <button id="addProductBtn">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
        <button id="clearProductsBtn" class="secondary">‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô)</button>
      </div>
      <p class="small muted">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á URL ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå (‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô data URL)</p>
    </div>

    <div class="card">
      <h4>üì¶ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h4>
      <div id="adminProducts" class="productGrid"></div>
    </div>

    <div class="card">
      <h4>üë• ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
      <div id="userList"></div>
    </div>
  </div>

</div>

<script>
const API_BASE = "https://6915a1fc84e8bd126afabc04.mockapi.io/goodpoints";
const ADMIN_PASS = "admin123";
const COOLDOWN_SECONDS = 20;

const $ = id => document.getElementById(id);
async function apiGet(path){ const r = await fetch(API_BASE + "/" + path); if(!r.ok) throw new Error('apiGet failed'); return r.json(); }
async function apiPost(path, data){ const r = await fetch(API_BASE + "/" + path, {method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(data)}); if(!r.ok) throw new Error('apiPost failed'); return r.json(); }
async function apiPut(path, data){ const r = await fetch(API_BASE + "/" + path, {method:"PUT", headers:{"Content-Type":"application/json"}, body:JSON.stringify(data)}); if(!r.ok) throw new Error('apiPut failed'); return r.json(); }
async function apiDelete(path){ const r = await fetch(API_BASE + "/" + path, {method:"DELETE"}); if(!r.ok) throw new Error('apiDelete failed'); return true; }

let currentUser = null;

$('loginBtn').addEventListener('click', onLogin);
$('demoProducts').addEventListener('click', addSampleProducts);
$('logoutUser').addEventListener('click', ()=> location.reload());
$('logoutAdmin').addEventListener('click', ()=> location.reload());
$('addProductBtn').addEventListener('click', onAddProduct);
$('clearProductsBtn').addEventListener('click', ()=> { if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô local) ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) localStorage.removeItem('gp_products'); loadAndRenderProducts(); });

async function loadAndRenderProducts(){
  try{
    const prods = await apiGet("products");
    renderProducts(prods);
    renderAdminProducts(prods);
  }catch(e){
    const local = JSON.parse(localStorage.getItem('gp_products')||'[]');
    renderProducts(local);
    renderAdminProducts(local);
  }
}

function renderProducts(prods){
  const box = $('products'); box.innerHTML = '';
  if(!prods || prods.length===0){ box.innerHTML = '<div class="small muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>'; return; }
  prods.forEach(p=>{
    const d = document.createElement('div'); d.className='productCard';
    d.innerHTML = `<img src="${p.image||defaultImg()}" alt=""><div style="padding:6px"><b>${escapeHtml(p.name)}</b><br><small>${p.cost} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</small><br><button onclick="onRedeem('${p.id}')">‡πÅ‡∏•‡∏Å</button></div>`;
    box.appendChild(d);
  });
}

function renderAdminProducts(prods){
  const box = $('adminProducts'); box.innerHTML = '';
  if(!prods || prods.length===0){ box.innerHTML = '<div class="small muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>'; return; }
  prods.forEach(p=>{
    const d = document.createElement('div'); d.className='productCard';
    d.innerHTML = `<img src="${p.image||defaultImg()}" alt=""><div style="padding:6px"><b>${escapeHtml(p.name)}</b><br><small>${p.cost} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</small><br><button onclick="onDeleteProduct('${p.id}')">‡∏•‡∏ö</button></div>`;
    box.appendChild(d);
  });
}

function defaultImg(){ return "https://picsum.photos/seed/gp/400/300"; }
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }

async function onLogin(){
  const name = $('nameInput').value.trim();
  const pass = $('adminPass').value;
  if(!name) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠');
  if(name.toLowerCase()==='admin'){
    if(pass !== ADMIN_PASS){ $('adminPass').style.display=''; return alert('‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); }
    showAdmin();
    return;
  }
  try{
    const users = await apiGet("users");
    let user = users.find(u=>u.name === name);
    if(!user){
      user = await apiPost("users", { name, points: 0, history: [], lastGoodAt: null });
    }
    currentUser = user;
    showUser();
  }catch(e){
    console.warn('API users fetch failed, fallback to local');
    const localUsers = JSON.parse(localStorage.getItem('gp_users')||'{}');
    if(!localUsers[name]){ localUsers[name] = { id: name, name, points:0, history:[], lastGoodAt:null }; localStorage.setItem('gp_users', JSON.stringify(localUsers)); }
    currentUser = localUsers[name];
    showUser();
  }
}

function showUser(){ $('loginCard').style.display='none'; $('userApp').style.display=''; $('userName').textContent = currentUser.name; updateUserUI(); loadAndRenderProducts(); }
function showAdmin(){ $('loginCard').style.display='none'; $('adminApp').style.display=''; loadAndRenderProducts(); renderUserList(); }

async function updateUserUI(){
  try{ const fresh = await apiGet("users/"+currentUser.id); currentUser = fresh; }catch(e){}
  $('userPoints').textContent = currentUser.points || 0;
  const list = $('redeemHistory'); list.innerHTML = '';
  (currentUser.history||[]).slice().reverse().forEach(h=>{ const li=document.createElement('li'); li.textContent = `${h.item} ‚Äî ${h.date}`; list.appendChild(li); });
  updateCooldownMsg();
}

$('doGoodBtn').addEventListener('click', async ()=>{
  try{
    const now = Date.now();
    const last = currentUser.lastGoodAt ? new Date(currentUser.lastGoodAt).getTime() : 0;
    if(now - last < COOLDOWN_SECONDS*1000){ const remain = Math.ceil((COOLDOWN_SECONDS*1000 - (now-last))/1000); return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏≠‡∏µ‡∏Å '+remain+' ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ'); }
    currentUser.points = (currentUser.points||0) + 1;
    currentUser.lastGoodAt = new Date().toISOString();
    await apiPut("users/"+currentUser.id, currentUser);
    await updateUserUI(); alert('‡πÄ‡∏û‡∏¥‡πà‡∏° 1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏µ üòä');
  }catch(e){
    currentUser.points = (currentUser.points||0) + 1;
    currentUser.lastGoodAt = new Date().toISOString();
    const lu = JSON.parse(localStorage.getItem('gp_users')||'{}'); lu[currentUser.name] = currentUser; localStorage.setItem('gp_users', JSON.stringify(lu));
    updateUserUI(); alert('‡πÄ‡∏û‡∏¥‡πà‡∏° 1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå)');
  }
});

function updateCooldownMsg(){ const last = currentUser && currentUser.lastGoodAt ? new Date(currentUser.lastGoodAt).getTime() : 0; const remain = Math.max(0, COOLDOWN_SECONDS - Math.floor((Date.now()-last)/1000)); $('cooldownMsg').textContent = remain>0 ? '‡∏£‡∏≠‡∏≠‡∏µ‡∏Å '+remain+' ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ' : '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏µ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢'; if(remain>0) setTimeout(updateCooldownMsg,1000); }

async function onRedeem(productId){
  try{
    const p = await apiGet("products/"+productId);
    if((currentUser.points||0) < p.cost) return alert('‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠');
    currentUser.points -= p.cost;
    currentUser.history = currentUser.history || [];
    currentUser.history.push({ item: p.name, date: new Date().toLocaleString() });
    await apiPut("users/"+currentUser.id, currentUser);
    await updateUserUI();
    alert('‡πÅ‡∏•‡∏Å '+p.name+' ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üéâ');
  }catch(e){ alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏•‡∏Å‡πÑ‡∏î‡πâ (‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß)'); console.error(e); }
}

async function onAddProduct(){
  const name = $('prodName').value.trim();
  const cost = parseInt($('prodCost').value);
  const url = $('prodImageUrl').value.trim();
  const file = $('prodImageFile').files[0];
  if(!name || !cost) return alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
  try{
    if(file){ const dataUrl = await readFileAsDataURL(file); await apiPost("products", { name, cost, image: dataUrl }); }
    else{ const imageToUse = url || defaultImg(); await apiPost("products", { name, cost, image: imageToUse }); }
    alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); $('prodName').value=''; $('prodCost').value=''; $('prodImageUrl').value=''; $('prodImageFile').value=''; loadAndRenderProducts();
  }catch(e){
    const local = JSON.parse(localStorage.getItem('gp_products')||'[]'); const id = 'local_'+Date.now(); local.push({ id, name, cost, image: url || (file? await readFileAsDataURL(file) : defaultImg()) }); localStorage.setItem('gp_products', JSON.stringify(local)); alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå)'); loadAndRenderProducts();
  }
}
function readFileAsDataURL(file){ return new Promise((res,rej)=>{ const r=new FileReader(); r.onload=e=>res(e.target.result); r.onerror=rej; r.readAsDataURL(file); }); }
async function onDeleteProduct(id){ if(!confirm('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ?')) return; try{ await apiDelete("products/"+id); alert('‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); loadAndRenderProducts(); }catch(e){ const local = JSON.parse(localStorage.getItem('gp_products')||'[]'); const remaining = local.filter(x=>x.id!==id); localStorage.setItem('gp_products', JSON.stringify(remaining)); alert('‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); loadAndRenderProducts(); } }

async function renderUserList(){ try{ const users = await apiGet("users"); const box = $('userList'); box.innerHTML = ''; users.forEach(u=>{ if(u.name==='admin') return; const div = document.createElement('div'); div.className='card'; div.style.marginBottom='8px'; div.innerHTML = `<b>${escapeHtml(u.name)}</b> ‚Äî ${u.points||0} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô<br><div style="margin-top:8px;display:flex;gap:8px;align-items:center"><input type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" id="give_${u.id}" style="width:100px;padding:6px;border-radius:6px;border:1px solid #ddd" /><button onclick="adminGivePoints('${u.id}')">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button><button onclick="adminViewHistory('${u.id}')" style="background:#6c7e6c">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button><button onclick="adminDeleteUser('${u.id}')" style="background:#c94a4a">‡∏•‡∏ö</button></div>`; box.appendChild(div); }); }catch(e){ $('userList').innerHTML = '<div class="small muted">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå)</div>'; } }

window.adminGivePoints = async function(id){ const input = document.getElementById('give_'+id); const n = parseInt(input.value); if(!n || n===0) return alert('‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°'); try{ const u = await apiGet("users/"+id); u.points = (u.points||0) + n; await apiPut("users/"+id, u); alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); renderUserList(); }catch(e){ alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß)'); console.error(e); } }

window.adminViewHistory = async function(id){ try{ const u = await apiGet("users/"+id); const items = u.history || []; if(items.length===0) return alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å'); let txt = '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å:\n'; items.slice().reverse().forEach(it=> txt += `- ${it.item} (${it.date})\n`); alert(txt); }catch(e){ alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'); } }

window.adminDeleteUser = async function(id){ if(!confirm('‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ?')) return; try{ await apiDelete("users/"+id); alert('‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); renderUserList(); }catch(e){ alert('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); } }

function addSampleProducts(){ const sample = [ { name: "‡∏™‡∏°‡∏∏‡∏î‡πÇ‡∏ô‡πâ‡∏ï", cost: 10, image: "https://picsum.photos/seed/note/400/300" }, { name: "‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤", cost: 5, image: "https://picsum.photos/seed/pen/400/300" }, { name: "‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå", cost: 3, image: "https://picsum.photos/seed/sticker/400/300" } ]; Promise.all(sample.map(s=> apiPost("products", s).catch(()=>null))).then(()=> loadAndRenderProducts()); }

$('nameInput').addEventListener('input', e=>{ if(e.target.value.trim().toLowerCase()==='admin') $('adminPass').style.display=''; else $('adminPass').style.display='none'; });

loadAndRenderProducts();
</script>
</body>
</html>
